/dts-v1/;
/include/ "system-conf.dtsi"
/ {
	chosen {
		bootargs = "console=ttyPS0,115200 root=/dev/mmcblk0p2 rw rootwait uio_pdrv_genirq.of_id=generic-uio";
        /* bootargs = "console=ttyPS0,115200 root=/dev/mmcblk0p2 rw earlyprintk rootfstype=ext4 rootwait devtmpfs.mount=1 uio_pdrv_genirq.of_id=generic-uio"; */
		stdout-path = "serial0:115200n8";
	};

	memory@0 {
		device_type = "memory";
		reg = <0x0 0x40000000>; /* 1GB total memory */
	};

	/* Reserve 32MB for DMA operations */
	reserved-memory {
		#address-cells = <1>;
		#size-cells = <1>;
		ranges;

		dma_reserved: dma-memory@10000000 {
			compatible = "shared-dma-pool";
			reg = <0x10000000 0x2000000>; /* 32MB at 256MB offset */
			no-map;
		};
	};

	amba_pl: amba_pl@0 {
		#address-cells = <1>;
		#size-cells = <1>;
		compatible = "simple-bus";
		ranges;

		/* AXI DMA with Scatter-Gather */
		uio_axi_dma: uio_axi_dma {
			compatible = "generic-uio";
			reg = <0x40400000 0x10000>; /* AXI DMA base address - 64K range */
			interrupt-parent = <&intc>;
			interrupts = <0 61 4>; /* S2MM interrupt - IRQ_F2P[0] */
			interrupt-names = "s2mm_introut";
			memory-region = <&dma_buffer_pool>;
			xlnx,addrwidth = <0x20>; /* 32-bit addressing */
			xlnx,sg-length-width = <0x17>; /* SG length width */
			status = "okay";
		};

		/* Control Register Interface */
		uio_control_reg: uio_control_reg {
			compatible = "generic-uio";
			reg = <0x80000000 0x1000>; /* Control registers - 4K range */
			status = "okay";
			/* Add interrupt if your control registers generate interrupts */
			/* interrupt-parent = <&intc>; */
			/* interrupts = <0 62 4>; */ /* IRQ_F2P[1] if needed */
			/* interrupt-names = "control_irq"; */
		};

		/* Status Register Interface */
		uio_status_reg: uio_status_reg {
			compatible = "generic-uio";
			reg = <0x80001000 0x1000>; /* Status registers - 4K range */
			status = "okay";
			/* Add interrupt if your status registers generate interrupts */
			/* interrupt-parent = <&intc>; */
			/* interrupts = <0 63 4>; */ /* IRQ_F2P[2] if needed */
			/* interrupt-names = "status_irq"; */
		};
	};
};

/* Alternative configuration using xlnx,axi-dma if you prefer native driver support */
/*
&amba_pl {
	axi_dma_0: dma@40400000 {
		compatible = "xlnx,axi-dma-1.00.a";
		reg = <0x40400000 0x10000>;
		#dma-cells = <1>;
		interrupt-parent = <&intc>;
		interrupts = <0 61 4>;
		memory-region = <&dma_reserved>;
		xlnx,addrwidth = <0x20>;
		xlnx,sg-length-width = <0x17>;
		xlnx,include-sg;
		xlnx,sg-include-stscntrl-strm = <0x0>;
		
		// S2MM channel only (MM2S disabled)
		dma-channel@40400030 {
			compatible = "xlnx,axi-dma-s2mm-channel";
			interrupts = <0 29 4>;
			xlnx,datawidth = <0x20>; // Adjust based on your data width
			xlnx,device-id = <0x0>;
		};
	};
};
*/